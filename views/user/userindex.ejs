<!DOCTYPE html>
<html lang="en">
  <head>
    <%- include('../layouts/head') %>
  </head>

  <body class="hold-transition light-skin sidebar-mini theme-primary fixed">
    <div class="wrapper">
      <!-- <div id="loader"></div> -->

      <header class="main-header">
        <!-- header-->
        <%- include('../layouts/header') %>
      </header>

      <aside class="main-sidebar">
        <!-- sidebar-->
        <%- include('../layouts/aside') %>
      </aside>

      <!-- Content Wrapper. Contains page content -->
      <div class="content-wrapper">
        <div class="container-full">
          <section class="content">
            <div class="col-9 col-xl-9">
              <div class="card">
                <div class="card-header">
                  <h5 class="card-title"><%=title%></h5>
                </div>
                <div>
                  <a
                    href="/user/users/create-user"
                    type="button"
                    class="waves-effect waves-light btn mb-5 bg-gradient-warning m-10"
                  >
                    <i class="fa fa-plus"></i> Add new
                  </a>
                </div>
                <div class="card-body">
                  <table class="table table-striped">
                    <thead>
                      <tr>
                        <th style="width: 40%">User Name</th>
                        <th style="width: 30%">User Email</th>
                        <th style="width: 20%">User Email</th>

                        <th style="width: 10%">Actions</th>
                      </tr>
                    </thead>

                    <tbody>
                      <% users.forEach((item) => { %>
                      <tr>
                        <td><%= item.fullName %></td>
                        <td><%= item.email %></td>
                        <td><%= item.role %></td>

                        <td class="table-action min-w-100">
                          <a
                            href="/user/profile/<%= item._id %>"
                            class="text-fade hover-primary"
                          >
                            <i data-feather="eye" style="color: #308345"></i>
                          </a>

                          <a
                            href="#"
                            class="text-fade hover-primary"
                            onclick="deleteUser('<%= item._id %>')"
                          >
                            <i data-feather="trash" style="color: #e74949"></i>
                          </a>
                        </td>
                      </tr>
                      <% }) %>
                    </tbody>
                  </table>

                  <div
                    class="dataTables_paginate paging_simple_numbers align-right"
                    id="example_paginate"
                  >
                    <ul class="pagination">
                      <li
                        class="paginate_button page-item previous <%= currentPage === 1 ? 'disabled' : '' %>"
                        id="example_previous"
                      >
                        <a
                          href="?page=<%= currentPage - 1 %>"
                          aria-controls="example"
                          tabindex="0"
                          class="page-link"
                          >Previous</a
                        >
                      </li>

                      <% for (let i = 1; i <= totalPages; i++) { %>
                      <li
                        class="paginate_button page-item <%= i === currentPage ? 'active' : '' %>"
                      >
                        <a
                          href="?page=<%= i %>"
                          aria-controls="example"
                          tabindex="0"
                          class="page-link"
                          ><%= i %></a
                        >
                      </li>
                      <% } %>

                      <li
                        class="paginate_button page-item next <%= currentPage === totalPages ? 'disabled' : '' %>"
                        id="example_next"
                      >
                        <a
                          href="?page=<%= currentPage + 1 %>"
                          aria-controls="example"
                          tabindex="0"
                          class="page-link"
                          >Next</a
                        >
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </div>
      <footer class="main-footer">
        <!-- footer-->
        <%- include('../layouts/footer') %>
      </footer>
      <!-- Side panel -->
      <!-- quick_user_toggle -->
      <div class="modal modal-right fade" id="quick_user_toggle" tabindex="-1">
        <!-- user profile -->
        <%- include('../layouts/right') %>
      </div>
      <!-- /quick_user_toggle -->

      <!-- Control Sidebar -->
      <%- include('../layouts/sidebar') %>
    </div>

    <!-- <%- include('../layouts/script') %> -->
    <script src="js/pages/data-table.js"></script>

    <!-- JavaScript code for deleting a portfolio -->
    <script>
      function deleteUser(userId) {
        if (confirm('Are you sure you want to delete this user?')) {
          fetch(`/user/${userId}`, {
            method: 'DELETE',
          })
            .then(response => response.json())
            .then(data => {
              alert(data.message);
              location.reload(); // Refresh the page after successful deletion
            })
            .catch(error => {
              console.error('Failed to delete user:', error);
              alert('Failed to delete user. Please try again.');
            });
        }
      }
    </script>
  </body>
</html>
